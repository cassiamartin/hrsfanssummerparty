<html>

<head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <link rel='stylesheet' type='text/css' href='static/style.css'>
    <link rel="icon" type="image/png" href="static/favicon.png" />
    <script type='text/javascript' src='static/knockout-3.2.0.js'></script>
    <script type='text/javascript' src='static/underscore-min.js'></script>
    <script type='text/javascript' src='static/jquery-2.1.1.min.js'></script>
    <script type='text/javascript' src='static/shared.js'></script>
    <script type='text/javascript' src='static/admin.js'></script>
    <title>HRSFANS Retreat Registration</title>
</head>

<body>

    <!-- ko if: loaded -->

    <div class='header_section header'>
        <p class='note'>Logged in as: <span data-bind='text: user_nickname'></span></p>
        <p class='logout'>
            <a class="pointer" data-bind='click: refresh_state'>Refresh now</a> |
            <a data-bind='attr: { href: logout_url }'>Log out</a>
        </p>
    </div>

    <div class='selector_section'>
        <!-- ko foreach: sections -->
            <div class='section_selector_container'>
                <div
                    class='section_selector'
                    data-bind='text: label, css: status_for_selector, click: try_set_visible'
                ></div>
            </div>
        <!-- /ko -->
    </div>

    <!-- ko with: record_payments -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <div class='message' data-bind='text: message'></div>

            <h2>Add or Edit Payment</h2>
            <div class="payment_editor">
                <!-- ko if: edit_payment --><p class='color_red'>
                    Editing selected payment:
                </p><!-- /ko -->
                <!-- ko if: !edit_payment() --><p>Recording new payment:</p><!-- /ko -->
                <p>
                    <div class="payment_left">Received</div>
                    $<input
                        class='money'
                        data-bind='value: edit_amount, valueUpdate: "afterkeydown"'
                    ></input>
                    from
                    <input
                        class='payment_input'
                        data-bind='value: edit_from, valueUpdate: "afterkeydown"'
                    ></input>
                    via
                    <input
                        class='payment_input'
                        data-bind='value: edit_via, valueUpdate: "afterkeydown"'
                    ></input>
                </p>
                <!-- ko foreach: edit_credits -->
                    <p>
                        <div class="payment_left">Credit</div>
                        $<input
                            class='money'
                            data-bind='value: amount, valueUpdate: "afterkeydown"'
                        ></input>
                        to
                        <select
                            class='payment_select'
                            data-bind='
                                options: $parent.financials,
                                optionsText: format_option,
                                optionsValue: "email",
                                optionsCaption: "",
                                value: email
                            '
                        ></select>
                    </p>
                <!-- /ko -->
                <p>
                    <a class="pointer" data-bind='click: add_edit_credit'>
                        (attach another registration)
                    </a>
                </p>
                <div class='action-area' data-bind="visible: status() == 'changed'">
                    <button class='bg_red pointer' data-bind='click: reset'>Reset</button>
                    <button class='save-button' data-bind='click: submit'>Save</button>
                    <button
                        class='delete-button'
                        data-bind='click: delete_pmt, visible: edit_payment()'
                    >
                        Delete
                    </button>
                    <span class="note" data-bind='text: change_summary'></span>
                </div>
            </div>

            <h2>Previously Recorded</h2>
            <p>
                Net received: <b><span data-bind='text: total_received'></span></b>
            </p>
            <p class='note'>
                Click an entry to edit it.  Entries in red have not been fully credited.
            </p>
            <table class='payment_records'><tbody data-bind='foreach: payments'>
                <tr class='pointer' data-bind='css: status, click: do_click'>
                    <td class='cell_label_medium' data-bind='text: srv_payment.date'></td>
                    <td class='payment_record_desc' data-bind='foreach: description()'>
                        <p data-bind='text: $data'></p>
                    </td>
                </tr>
            </tbody></table>
        </div>
    <!-- /ko -->

    <!-- ko with: record_expenses -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <div class='message' data-bind='text: message'></div>

            <h2>Add or Edit Credit</h2>
            <div class="payment_editor">
                <!-- ko if: edit_expense --><p class='color_red'>
                    Editing selected credit:
                </p><!-- /ko -->
                <!-- ko if: !edit_expense() --><p>Recording new credit:</p><!-- /ko -->
                <p>
                    <div class="payment_left">Amount of</div>
                    $<input
                        class='money'
                        data-bind='value: edit_amount, valueUpdate: "afterkeydown"'
                    ></input>
                    from
                    <select
                        class='expense_select'
                        data-bind='
                            options: financials,
                            optionsText: format_option,
                            optionsValue: "email",
                            optionsCaption: "",
                            value: edit_email
                        '
                    ></select>
                    for
                    <input
                        class='payment_input'
                        data-bind='value: edit_description, valueUpdate: "afterkeydown"'
                    ></input>
                <!-- ko foreach: edit_categories -->
                    <p>
                        <div class="payment_left">Categorize</div>
                        $<input
                            class='money'
                            data-bind='value: amount, valueUpdate: "afterkeydown"'
                        ></input>
                        as
                        <select
                            class='payment_select'
                            data-bind='value: category'
                        >
                            <option value=''>(Please select an option.)</option>
                            <option value='Expense: Deposits'>Expense: Deposits</option>
                            <option value='Expense: Houses / Hotels'>Expense: Houses / Hotels</option>
                            <option value='Expense: Meals'>Expense: Meals</option>
                            <option value='Expense: Snacks'>Expense: Snacks</option>
                            <option value='Expense: Supplies'>Expense: Supplies</option>
                            <option value='Expense: Other'>Expense: Other</option>
                            <option value='Adjustment: Meals'>Adjustment: Meals</option>
                            <option value='Adjustment: Rooms'>Adjustment: Rooms</option>
                            <option value='Adjustment: Other'>Adjustment: Other</option>
                            <option value='Donations: General'>Donations: General</option>
                        </select>
                    </p>
                <!-- /ko -->
                <p>
                    <a class="pointer" data-bind='click: add_edit_category'>
                        (add another category)
                    </a>
                </p>
                <div class='action-area' data-bind="visible: status() == 'changed'">
                    <button class='bg_red pointer' data-bind='click: reset'>Reset</button>
                    <button class='save-button' data-bind='click: submit'>Save</button>
                    <button
                        class='delete-button'
                        data-bind='click: delete_exp, visible: edit_expense()'
                    >
                        Delete
                    </button>
                    <span class="note" data-bind='text: change_summary'></span>
                </div>
            </div>

            <h2>Previously Recorded</h2>
            <p>
                Total credits: <b><span data-bind='text: total_expenses'></span></b>
            </p>
            <p class='note'>
                Click an entry to edit it.
            </p>
            <table class='payment_records'><tbody data-bind='foreach: expenses'>
                <tr class='pointer' data-bind='css: status, click: do_click'>
                    <td class='cell_label_medium' data-bind='text: srv_expense.date'></td>
                    <td class='payment_record_desc' data-bind='foreach: description()'>
                        <p data-bind='text: $data'></p>
                    </td>
                </tr>
            </tbody></table>
        </div>
    <!-- /ko -->

    <!-- ko with: registrations -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <p data-bind='with: summary'>
                <b><span data-bind='text: total'></span></b> registrations
                (<b><span data-bind='text: unconfirmed'></span></b> unconfirmed,
                <b><span data-bind='text: unpaid'></span></b> unpaid).
            </p>
            <table class="admin_reg_table">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Nights</th>
                    <th>Due</th>
                </tr>
                <!-- ko foreach: table -->
                    <tr>
                        <td
                            class='cell_name bg_gray'
                            data-bind='text: name'
                        ></td>
                        <td
                            class='cell_info_wide bg_gray'
                            data-bind='text: email'
                        ></td>
                        <td
                            class='cell_value'
                            data-bind='
                                text: nights > 0 ? nights : "",
                                css: confirmed ? "bg_green" : "bg_gray"
                            '
                        ></td>
                        <td
                            class='cell_value'
                            data-bind='
                                text: Math.abs(due) >= 0.005 ? _.dollar_val(due, 2) : "",
                                css: Math.abs(due) >= 0.005 ? "bg_yellow" : "bg_gray"
                            '
                        ></td>
                    </tr>
                <!-- /ko -->
            </table>
        </div>
    <!-- /ko -->

    <!-- ko with: financial -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <h2>Summary</h2>
            <table class='pmt_table' data-bind='with: summary'>
                <tr>
                    <td class='borderless pmt_group'>Income</td>
                    <td class='cell_info_wide bg_slate' colspan='2'>Rooms</td>
                    <td
                        class='cell_value bg_slate'
                        data-bind='text: _.dollar_val(rooms, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='cell_info_wide bg_slate' colspan='2'>Meals</td>
                    <td
                        class='cell_value bg_slate'
                        data-bind='text: _.dollar_val(meals, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='bg_purple'>
                        Transport subsidy contributions (<span data-bind='text: subsidy_plus_count'>
                        </span>)
                    </td>
                    <td
                        class='cell_value bg_purple'
                        data-bind='text: _.dollar_val(subsidy_plus, 2)'
                    ></td>
                    <td class='cell_value bg_slate'></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='bg_purple'>
                        Transport subsidy requests (<span data-bind='text: subsidy_minus_count'>
                        </span>)
                    </td>
                    <td
                        class='cell_value bg_purple'
                        data-bind='text: _.dollar_val(subsidy_minus, 2)'
                    ></td>
                    <td class='cell_value bg_slate'></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='cell_info_wide bg_slate' colspan='2'>Transport subsidy (net)</td>
                    <td
                        class='cell_value bg_slate'
                        data-bind='text: _.dollar_val(subsidy, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='bg_purple'>
                        Financial aid contributions (<span data-bind='text: aid_plus_count'></span>)
                    </td>
                    <td
                        class='cell_value bg_purple'
                        data-bind='text: _.dollar_val(aid_plus, 2)'
                    ></td>
                    <td class='cell_value bg_slate'></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='bg_purple'>
                        Financial aid requests (<span data-bind='text: aid_minus_count'></span>)
                    </td>
                    <td
                        class='cell_value bg_purple'
                        data-bind='text: _.dollar_val(aid_minus, 2)'
                    ></td>
                    <td class='cell_value bg_slate'></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='cell_info_wide bg_slate' colspan='2'>Financial aid (net)</td>
                    <td
                        class='cell_value bg_slate'
                        data-bind='text: _.dollar_val(aid, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='cell_info_wide bg_gray' colspan='2'>Total</td>
                    <td
                        class='cell_value bg_gray'
                        data-bind='text: _.dollar_val(total_income, 2)'
                    ></td>
                </tr>
                <!-- ko if: expenses.length -->
                    <!-- ko foreach: expenses -->
                        <tr>
                            <td
                                class='borderless pmt_group'
                                data-bind='text: $index() == 0 ? "Outlays" : ""'
                            ></td>
                            <td
                                class='cell_info_wide bg_slate'
                                colspan='2'
                                data-bind='text: category'
                            ></td>
                            <td
                                class='cell_value bg_slate'
                                data-bind='text: _.dollar_val(amount, 2)'
                            ></td>
                        </tr>
                    <!-- /ko -->
                    <tr>
                        <td class='borderless pmt_group'></td>
                        <td class='cell_info_wide bg_gray' colspan='2'>Total</td>
                        <td
                            class='cell_value bg_gray'
                            data-bind='text: _.dollar_val(total_expenses, 2)'
                        ></td>
                    </tr>
                <!-- /ko -->
                <tr>
                    <td class='borderless pmt_group'>Net</td>
                    <td class='cell_info_wide bg_green' colspan='2'>Total surplus or (deficit)</td>
                    <td
                        class='cell_value bg_green'
                        data-bind='text: _.dollar_val(surplus, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'>Cashflows</td>
                    <td class='cell_info_wide bg_gray' colspan='2'>Net received*</td>
                    <td
                        class='cell_value bg_gray'
                        data-bind='text: _.dollar_val(received, 2)'
                    ></td>
                </tr>
                <tr>
                    <td class='borderless pmt_group'></td>
                    <td class='cell_info_wide bg_yellow' colspan='2'>Due</td>
                    <td
                        class='cell_value bg_yellow'
                        data-bind='text: _.dollar_val(due, 2)'
                    ></td>
                </tr>
            </table>
            <p class="note">
                *This is computed differently from the amount in the first section, but should match
                it.  If it doesn't, there's a problem!
            </p>

            <h2>Details</h2>
            <table class="aid_table">
                <tr>
                    <th>Name</th>
                    <th>Rooms</th>
                    <th>Meals</th>
                    <th>Subsidy</th>
                    <th>Aid</th>
                    <th>Pledge</th>
                </tr>
                <tbody data-bind='foreach: table'>
                    <tr>
                        <td class="cell_name bg_gray" data-bind='text: name'></td>
                        <td
                            class="cell_value bg_slate"
                            data-bind='text: $parent.format_val(rooms)'
                        ></td>
                        <td
                            class="cell_value bg_slate"
                            data-bind='text: $parent.format_val(meals)'
                        ></td>
                        <td
                            class="cell_value"
                            data-bind='
                                text: $parent.format_val(subsidy),
                                css: $parent.class_val(subsidy)
                            '
                        ></td>
                        <td
                            class="cell_value"
                            data-bind='
                                text: $parent.format_val(aid),
                                css: $parent.class_val(aid)
                            '
                        ></td>
                        <td
                            class="cell_value bg_slate"
                            data-bind='text: $parent.format_val(aid_pledge)'
                        ></td>
                    </tr>
                </tbody>
            </table>
        </div>
    <!-- /ko -->

    <!-- ko with: meals -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <table class="meals_table">
                <tr>
                    <th></th>
                    <!-- ko foreach: $root.party_data.meals -->
                        <th class="meal_header_name" data-bind='text: name'></th>
                    <!-- /ko -->
                    <th>Restrictions</th>
                </tr>
                <tr>
                    <td class="meal_summary">Cost</td>
                    <!-- ko foreach: $root.party_data.meals -->
                        <td
                            class="meal_total bg_gray"
                            data-bind='text: _.dollar_val(cost)'
                        ></td>
                    <!-- /ko -->
                    <td class='borderless'></td>
                </tr>
                <!-- ko with: summary -->
                    <tr>
                        <td class="meal_summary bg_green">Total yes</td>
                        <!-- ko foreach: $root.party_data.meals -->
                            <td
                                class="meal_total bg_gray"
                                data-bind='text: $parent[id].yes'
                            ></td>
                        <!-- /ko -->
                        <td class='borderless'></td>
                    </tr>
                    <tr>
                        <td class="meal_summary bg_slate">Total maybe</td>
                        <!-- ko foreach: $root.party_data.meals -->
                            <td
                                class="meal_total bg_gray"
                                data-bind='text: $parent[id].maybe'
                            ></td>
                        <!-- /ko -->
                        <td class='borderless'></td>
                    </tr>
                    <tr>
                        <td class="meal_summary bg_purple">Total no</td>
                        <!-- ko foreach: $root.party_data.meals -->
                            <td
                                class="meal_total bg_gray"
                                data-bind='text: $parent[id].no'
                            ></td>
                        <!-- /ko -->
                        <td class='borderless'></td>
                    </tr>
                <!-- /ko -->
                <!-- ko foreach: table -->
                    <tr>
                        <td class='cell_name bg_gray' data-bind='text: name'></td>
                        <!-- ko foreach: $root.party_data.meals -->
                                <td
                                    class='meal_cell'
                                    data-bind='css: $parents[1].color_table[$parent.meals[id]]'
                                ></td>
                        <!-- /ko -->
                        <td
                            class='cell_info_medium bg_gray'
                            data-bind='
                                text: dietary,
                                attr: { title: dietary }
                            '
                        ></td>
                    </tr>
                <!-- /ko -->
            </table>
        </div>
    <!-- /ko -->

    <!-- ko with: personal_info -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <div data-bind="foreach: data">
                <h3 class="personal_header">
                    <span data-bind="text: name"></span>
                    (<span data-bind="text: full_name"></span>)
                </h3>
                <p class="personal_item">
                    <b>Emergency contact:</b> <span data-bind="text: emergency"></span>
                </p>
                <p class="personal_item" data-bind="if: driving">
                    <b>Driving:</b> <span data-bind="text: driving"></span>
                </p>
                <p class="personal_item" data-bind="if: medical">
                    <b>Medical information:</b> <span data-bind="text: medical"></span>
                </p>
                <p class="personal_item" data-bind="if: children">
                    <b>Young children:</b> <span data-bind="text: children"></span>
                </p>
                <p class="personal_item" data-bind="if: guest">
                    <b>Guest of:</b> <span data-bind="text: guest"></span>
                </p>
            </div>
        </div>
    <!-- /ko -->

    <!-- ko with: email_list -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <p class="email_list" data-bind="foreach: data">
                <span data-bind="text: email"></span><br>
            </p>
        </div>
    <!-- /ko -->

    <!-- ko with: phone_list -->
        <div class="section" data-bind='css: status, visible: $parent.visible_section() == $data'>
            <table class="phone_table">
                <tbody data-bind="foreach: data">
                    <tr>
                        <td class="cell_name bg_gray" data-bind="text: $data[0]"></td>
                        <td
                            class="cell_info_wide bg_yellow"
                            data-bind="text: $data[1], attr: { title: $data[1] }"
                        ></td>
                        <td class="borderless phone_table_separator"></td>
                        <td
                            class="cell_info_wide bg_yellow"
                            data-bind="text: $data[2], attr: { title: $data[2] }"
                        ></td>
                        <td class="cell_name bg_gray" data-bind="text: $data[3]"></td>
                    </tr>
                <tbody>
            </table>
        </div>
    <!-- /ko -->

    <!-- /ko -->

</body>

</html>
